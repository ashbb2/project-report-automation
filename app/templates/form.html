<!DOCTYPE html>
<html>
<head>
    <title>Project Report Automation</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
        h1 { color: #333; }
        form { display: flex; flex-direction: column; gap: 15px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; color: #555; }
        input, textarea { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: Arial, sans-serif; }
        input:focus, textarea:focus { outline: none; border-color: #007bff; box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); }
        button { padding: 12px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        button.download { background-color: #28a745; margin-top: 10px; }
        button.download:hover { background-color: #218838; }
        .error { color: red; margin-top: 10px; padding: 10px; background-color: #ffe6e6; border-radius: 4px; display: none; }
        .success { color: green; margin-top: 10px; padding: 10px; background-color: #e6ffe6; border-radius: 4px; display: none; }
        #downloadSection { display: none; margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 4px; border: 2px solid #28a745; }
        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid #fff; border-top-color: transparent; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 8px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>Project Feasibility Report Generator</h1>
    <form id="submissionForm">
        <div class="form-group">
            <label for="business_idea">Business Idea *</label>
            <textarea name="business_idea" id="business_idea" placeholder="Describe your business idea" rows="4" required></textarea>
        </div>

        <div class="form-group">
            <label for="location_land">Location & Land Details *</label>
            <textarea name="location_land" id="location_land" placeholder="Provide location and land details" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="promoter_background">Promoter Background *</label>
            <textarea name="promoter_background" id="promoter_background" placeholder="Describe the promoter's background and experience" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="goals">Project Goals *</label>
            <textarea name="goals" id="goals" placeholder="Outline the main goals of the project" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="start_date">Start Date *</label>
            <input type="date" name="start_date" id="start_date" required>
        </div>

        <div class="form-group">
            <label for="target_launch_date">Target Launch Date *</label>
            <input type="date" name="target_launch_date" id="target_launch_date" required>
        </div>

        <div class="form-group">
            <label for="budget">Budget (in currency units) *</label>
            <input type="number" name="budget" id="budget" placeholder="Enter total budget" step="0.01" required>
        </div>

        <div class="form-group">
            <label for="target_market">Target Market *</label>
            <textarea name="target_market" id="target_market" placeholder="Describe your target market" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="notes">Additional Notes</label>
            <textarea name="notes" id="notes" placeholder="Any additional information (optional)" rows="3"></textarea>
        </div>

        <button type="submit">Generate Report</button>
        <div class="error" id="errorMessage"></div>
        <div class="success" id="successMessage"></div>
    </form>

    <div id="downloadSection">
        <h3>âœ“ Report Ready!</h3>
        <p>Your feasibility report has been generated successfully.</p>
        <button class="download" id="downloadButton">ðŸ“¥ Download Report (.docx)</button>
    </div>

    <script>
        let currentSubmissionId = null;

        document.getElementById('submissionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            const downloadSection = document.getElementById('downloadSection');
            
            // Clear messages
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';
            downloadSection.style.display = 'none';
            
            // Get form data
            const formData = new FormData(form);
            const data = {
                business_idea: formData.get('business_idea'),
                location_land: formData.get('location_land'),
                promoter_background: formData.get('promoter_background'),
                goals: formData.get('goals'),
                start_date: formData.get('start_date'),
                target_launch_date: formData.get('target_launch_date'),
                budget: parseFloat(formData.get('budget')),
                target_market: formData.get('target_market'),
                notes: formData.get('notes') || null
            };
            
            try {
                const response = await fetch('/api/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'Submission failed');
                }
                
                const result = await response.json();
                currentSubmissionId = result.id;
                successDiv.textContent = `âœ“ Submission successful! ID: ${result.id}`;
                successDiv.style.display = 'block';
                downloadSection.style.display = 'block';
                form.reset();
            } catch (error) {
                errorDiv.textContent = `âœ— Error: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        });

        document.getElementById('downloadButton').addEventListener('click', async () => {
            if (!currentSubmissionId) return;
            
            const button = document.getElementById('downloadButton');
            const originalText = button.innerHTML;
            
            try {
                // Show progress
                button.disabled = true;
                button.innerHTML = '<span class="spinner"></span>Generating Report...';
                
                // Fetch the report
                const response = await fetch(`/api/report/${currentSubmissionId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to generate report');
                }
                
                // Get the blob and trigger download
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `report_${currentSubmissionId}.docx`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Reset button
                button.disabled = false;
                button.innerHTML = originalText;
            } catch (error) {
                button.disabled = false;
                button.innerHTML = originalText;
                alert('Error downloading report: ' + error.message);
            }
        });
    </script>
</body>
</html>
